---
layout: post #默认post布局

title: Flask使用记录
description: Flask使用及踩坑
author: [diexie, ] # 此处可以简写，详细添加在 _data/authors.yml 中
date: 2025-02-26 11:33:00 +0800

pin: false # 置顶
categories: [杂项, Demo] # 分类,第一个为主分类
tags: [模板] # 标签

math: true # 支持数学公式
toc: true # 支持侧边目录
comments: true # 支持评论
mermaid: true # 支持mermaid图表

# cdn: https://xxxx.com/ # CDN加速，可以与media_subpath配合使用：[site.cdn/][page.media_subpath/]file.ext
# media_subpath: /assets/img/ # 媒体文件路径，用于简写本地图片等媒体文件路径，注意：封面图路径**会受影响**

image:
  path: https://picx.zhimg.com/70/v2-eaec95835ad51dbdb0ed240cae7dc4f1_1440w.avis?source=172ae18b&biz_tag=Post # 封面图
  lqip: data:image/webp # lqip占位符，用于图片懒加载
  alt: 『这是头图的描述』 # 头图描述
---

> Flask是一个轻量级的Web应用框架，基于Werkzeug和Jinja2。

## 参考链接

推荐使用官方文档入门
[官方文档](https://flask.palletsprojects.com/zh-cn/stable/#user-s-guide)

[菜鸟教程](https://www.runoob.com/flask/flask-tutorial.html)

[第三方教程文档-HelloFlask](https://docs.helloflask.com/)

## 安装

```bash
pip install Flask
```

## 基础使用

### 基础项目结构

```bash
/home/user/Projects/flask-tutorial
├── flaskr/ # 用于存放应用代码和文件
│   ├── __init__.py
│   ├── db.py
│   ├── schema.sql
│   ├── auth.py
│   ├── blog.py
│   ├── templates/ # 用于存放模板文件，支持Jinja2模板引擎
│   │   ├── base.html
│   │   ├── auth/
│   │   │   ├── login.html
│   │   │   └── register.html
│   │   └── blog/
│   │       ├── create.html
│   │       ├── index.html
│   │       └── update.html
│   └── static/ # 用于存放静态文件
│       └── style.css
├── tests/ # 一个包含测试模块的目录
│   ├── conftest.py
│   ├── data.sql
│   ├── test_factory.py
│   ├── test_db.py
│   ├── test_auth.py
│   └── test_blog.py
├── .venv/ # python自带的虚拟环境， 详情见[venv](https://docs.python.org/zh-cn/3/library/venv.html)
├── pyproject.toml
└── MANIFEST.in
```

### 基础类/函数概览

详细API见[官方文档](https://flask.palletsprojects.com/zh-cn/stable/api/)

- Flask: 核心对象，实现WSGI应用，作为中心对象，用于注册视图函数、URL规则、模板配置等。

- request: 对象，用于处理请求数据，包含请求头、查询字符串、表单数据、cookies、文件数据等。

- session: 对象，用于存储用户会话信息，基于签名cookie实现，支持字典操作。

- render_template: 函数，用于渲染模板，返回模板文件的内容，支持Jinja2模板引擎。

- url_for: 函数，用于构建URL，接受函数名作为第一个参数，返回URL。

- redirect: 函数，用于重定向，接受URL作为参数，返回重定向响应。

- make_response: 函数，用于显式地构建响应，接受响应内容、状态码、响应头作为参数，返回响应对象Response。

- redirect: 函数，用于重定向，接受URL作为参数，返回重定向响应，常配合url_for使用。

- escape: 函数，用于转义HTML字符，返回转义后的字符串。

### Flask的最小实例

```python
from flask import Flask # 导入Flask类，用于创建app

# The flask object implements a WSGI application and acts as the central object.
# It is passed the name of the module or package of the application.
# Once it is created it will act as a central registry for the view functions, the URL rules, template configuration and much more.
app = Flask(__name__) # 创建一个应用，核心对象

@app.route('/') # 路由装饰器，用于注册视图函数和URL规则
def hello_world():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run() # 运行应用，可选，或者通过flask run命令运行，详见后文"运行应用"
```

运行应用

```bash
flask --app hello_world run # 运行应用hello_world.py, 默认端口5000
flask run --host=0.0.0.0 --port=5001 # 指定主机和端口
flask run --debug # 调试模式下运行
```

### 路由

> 使用route()装饰器将**函数**绑定到**URL**，当访问URL时，执行绑定的函数；支持动态URL，支持多个路由绑定到同一个函数。

#### 1. 基本路由

```python

@app.route('/') # 将index()函数绑定到根URL
def index():
    return 'Index Page'

@app.route('/hello') # 将hello()函数绑定到/hello URL
def hello():
    return 'Hello, World!'
```

#### 2. 动态路由

```python
@app.route('/user/<username>') # 将user()函数绑定到/user/<username> URL
def user(username): # <username>是动态部分，作为参数传递给user()函数
    return f'User {username}'

@app.route('/post/<int:post_id>') # 将post()函数绑定到/post/<post_id> URL，限制post_id为整数
def post(post_id): # <post_id>是动态部分，作为参数传递给post()函数
    return f'Post {post_id}'
```

支持的转换器类型:

- string: 接受任何不包含斜杠的文本（默认）
- int: 接受正整数
- float: 接受正浮点数
- path: 类似string，但可以包含斜杠
- uuid: 接受UUID字符串

#### 3. 多URL绑定

```python
@app.route('/name/') # 将name()函数绑定到/name/ URL
@app.route('/name/<name>') # 将name()函数绑定到/name/<name> URL
def name(name=None): # name是可选参数，如果不传递参数，默认为空字符串
    return f'Name {name}'
```

#### 4. HTTP方法

> route()装饰器接受methods参数，限制HTTP方法，支持GET、POST、PUT、DELETE等。

```python
@app.route('/login', methods=['GET', 'POST']) # 将login()函数绑定到/login URL，限制GET和POST方法
def login():
    if request.method == 'POST':
        return 'Login POST'
    else:
        return 'Login GET'
```

```python
@app.route('/login', methods=['POST']) # 将login()函数绑定到/login URL，限制POST方法
def login():
    return 'Login POST'

@app.post('/login') # 限制POST方法，等价于@app.route('/login', methods=['POST'])
def login():
    return 'Login POST'

```

### URL构建

> 使用url_for()函数构建URL，接受函数名作为第一个参数，返回URL。
> 从**视图函数**到**URL**的**反向映射**，可以避免硬编码URL，提高代码的可维护性。

```python
from flask import url_for,Flask
app = Flask(__name__) # 创建一个应用，核心对象，之后的示例中会省略

@app.route('/login') # 将login()函数绑定到/login URL
def login():
    return 'Login'

@app.route('/user/<username>') # 将user()函数绑定到/user/<username> URL
def user(username):
    return f'User {username}'

if __name__ == '__main__':
    with app.test_request_context(): # 创建一个请求上下文，用于测试
        print(url_for('login')) # 输出: /login
        print(url_for('login', next='/')) # 输出: /login?next=/ ，next是查询参数
        print(url_for('user', username='John')) # 输出: /user/John
```

### 静态文件

> 使用url_for()函数构建静态文件URL，接受特殊的static参数，返回静态文件URL。

```python
from flask import url_for

url_for('static', filename='style.css') # 输出: /static/style.css
```

注意，Flask默认将static文件夹作为静态文件目录，可以通过static_folder参数指定静态文件目录。

```python
app = Flask(__name__, static_folder='static') # 指定static文件夹为静态文件目录
```

### 模板渲染

> Flask支持Jinja2模板引擎，使用render_template()函数渲染模板，返回模板文件的内容。

详细请参考[官方文档](https://flask.palletsprojects.com/zh-cn/stable/templating/)

```python
from flask import render_template

@app.route('/hello/<name>') # 将hello()函数绑定到/hello/<name> URL
def hello(name=None): # name是可选参数，如果不传递参数，默认为空字符串
    return render_template('hello.html', name=name) # 渲染hello.html模板，传递name参数
```

```html
# hello.html模板：
<!doctype html>
<title>Hello from Flask</title>
{% if name %}
  <h1>Hello {{ name }}!</h1> # 模板中可以使用 config、request、session、g、url_for等变量
{% else %}
  <h1>Hello, World!</h1>
{% endif %}
```

注意，Flask默认将templates文件夹作为模板文件目录，可以通过template_folder参数指定模板文件目录。

```python
app = Flask(__name__, template_folder='templates') # 指定templates文件夹为模板文件目录
```

### 访问请求数据

> 使用[request](https://flask.palletsprojects.com/zh-cn/stable/api/#flask.Request)对象处理请求数据，包含请求头、查询字符串、表单数据、cookies、文件数据等。

```python
from flask import request # 导入request对象

@app.route('/login', methods=['GET', 'POST']) # 将login()函数绑定到/login URL，限制GET和POST方法
def login():
    request_path = request.path # 请求路径，/login
    request_method = request.method # 请求方法，GET或POST
    request_form_dict = request.form # 表单数据，字典形式
    request_args_dict = request.args # 查询字符串，字典形式, 用于处理URL中的查询参数(?key=value)
    request_files_dict = request.files # 文件数据，字典形式
    request_cookies_dict = request.cookies # cookies数据，字典形式

    return f'Path: {request_path}, Method: {request_method}, Form: {request_form_dict}, Args: {request_args_dict}, Files: {request_files_dict}, Cookies: {request_cookies_dict}'
```









